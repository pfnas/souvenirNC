<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mon Album Souvenirs Interactif</title>
  <link rel="stylesheet" href="./css/style.css">
  <!-- Chargement de Tailwind CSS pour un style moderne et réactif -->
  <script src="https://cdn.tailwindcss.com"></script>
  
</head>
<body class="bg-gray-100 font-sans p-4">

  <div class="max-w-6xl mx-auto py-8">
    <h1 class="text-4xl font-extrabold text-center text-green-700 mb-4">
      Mon Album Souvenirs
    </h1>
    
    <!-- Conteneur principal qui sera transformé en livre par Turn.js -->
    <div class="flip-book-container">
      <div id="monAlbum" class="rounded-lg shadow-2xl">
        <!-- Les pages seront ajoutées ici par JavaScript -->
      </div>
    </div>
   
    <!-- Boutons de navigation (Centrés et stylisés) -->
    <div class="navigation-buttons flex justify-center space-x-4 mt-8">
      <button id="prevBtn" class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-full shadow-md transition duration-200 disabled:opacity-50">
        ← Précédent
      </button>
      <button id="nextBtn" class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-full shadow-md transition duration-200 disabled:opacity-50">
        Suivant →
      </button>
    </div>
    
  </div>

  <!-- NOUVEAUX CHARGEMENTS VIA CDN -->
  <!-- 1. jQuery DOIT être chargé en premier -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <!-- 2. Turn.js DOIT être chargé après jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>
  
  <!-- 3. Votre script personnalisé (intégré dans ce bloc) -->
  <script>
    // --- Simulation des données (remplace album.json) ---
    const albumData = [
      { type: 'cover', title: 'Six mois en Calédonie', subtitle: '______', media: null }, // Page 1 (Couverture)
      
       // Page 2 (Texte Centré)
      { 
        type: 'content', 
        layout: 'text-only', 
        text: `
          <p class="mb-4">"Le vrai voyage de découverte ne consiste pas à chercher de nouveaux paysages, mais à avoir de nouveaux yeux."</p>
          <p class="font-semibold text-green-600 mb-6"> - Marcel Proust</p>
          <p class="text-base text-gray-500 italic">Ces six mois m'ont non seulement montré le monde, mais ils m'ont transformé.</p>
        `
      }, 
      
      // --- VOTRE PAGE RÉTABLIE (Page 3) ---
      { 
        type: 'content', 
        layout: 'text-only', 
        text: `
          <p class="mb-4 text-2xl font-bold text-gray-800">Un voyage en Nouvelle Calédonie, ça demande de la patience, ça prend approximativement de 25h à 7 jours.</p>
        `
      }, 

      // Page 4 (DEUX IMAGES PORTRAIT CÔTE À CÔTE)
      { 
          type: 'content', 
          layout: 'portrait-pair', 
          media: [ 
              { url: 'images/sac.webp', caption: 'Le départ' },
              { url: 'images/sac1.webp', caption: 'pareil' }
          ] 
      }, 
            // Page 3 (Vidéo)
      {
        type: 'content',
        layout: 'video',
        media: [
          { url: 'videos/VID_20250516_072230.mp4', caption: 'Une arrivée magique' } 
        ],
      }, 
             // Page 4 (Vidéo)
      {
        type: 'content',
        layout: 'video',
        media: [
          { url: 'videos/VID_20250516_072340.mp4', caption: 'Une arrivée magique' } 
        ],
      }, 
        // --- VOTRE PAGE RÉTABLIE (Page 5) ---
      { 
        type: 'content', 
        layout: 'text-only', 
        text: `
          <p class="mb-4 text-2xl font-bold text-gray-800">-----</p>
        `
      }, 
      
      // Page 6 (Une seule image Portrait)
      { type: 'content', layout: 'portrait', media: [ { url: 'images/bananes.webp', caption: 'Le petit paradis' } ] }, 

      // Page 6 (2 Paysages Empilés)
      // { type: 'content', layout: 'landscape-pair', media: [ { url: 'https://placehold.co/450x250/059669/ffffff?text=Image+Paysage+Haut', caption: 'Le village depuis la colline' }, { url: 'https://placehold.co/450x250/10b981/ffffff?text=Photo+6', caption: 'Le plat local' } ] }, 
            
      // Page 6 (UNE SEULE IMAGE PAYSAGE LARGE)
      { 
          type: 'content', 
          layout: 'landscape-only', 
          media: [ 
              { url: 'images/jardin.webp', caption: 'Petit levé de soleil .' }
          ] 
      }, 

      // Page 9 (Portrait)
      { type: 'content', layout: 'portrait', media: [ { url: 'images/paysage_koe.webp', caption: 'Sur la route de Koé.' } ] }, 
      
      { type: 'cover', title: 'Bye la Province Sud', subtitle: 'To be continued', media: null } // Page 10 (Couverture)
    ];

    const $album = $('#monAlbum');
    const $prevBtn = $('#prevBtn');
    const $nextBtn = $('#nextBtn');
    
    // Constantes pour les dimensions de base
    const PAGE_ASPECT_RATIO = 4/3; // Hauteur / Largeur (ex: 600px / 450px)
    let isTurnInitialized = false; 
    
    // Fonction utilitaire pour créer le contenu de chaque page
    function createPageElement(data, index) {
      let contentHTML = '';
      const isCover = (index === 0 || index === albumData.length - 1);
      
      // Code pour afficher une image de substitution en cas d'erreur de chargement
      const fallbackImageAction = (isLandscape) => {
        // Le fallback utilise des placeholders
        const placeholder = isLandscape ? 'https://placehold.co/450x250/10b981/ffffff?text=ERREUR' : 'https://placehold.co/450x550/10b981/ffffff?text=ERREUR';
        return `console.error('Erreur de chargement de l\\'image:', this.src); this.onerror=null; this.src='${placeholder}'; this.style.opacity='0.9';`;
      };


      // La première et la dernière page sont des couvertures
      if (isCover) {
        contentHTML = `
          <div class="cover-page flex flex-col justify-center items-center w-full h-full p-4">
            <h2 class="w-full text-3xl md:text-5xl font-bold text-center">${data.title}</h2>
            <p class="w-full text-lg md:text-xl mt-4 opacity-80 text-center">${data.subtitle}</p>
          </div>
        `;
      } else {
        // Pages de contenu
        
        if (data.layout === 'portrait') {
            // Mise en page 1: Une seule image (Portrait)
            const media = data.media[0];
            contentHTML = `
              <div class="content-page-wrapper flex-col justify-between items-center space-y-4">
                <img src="${media.url}" alt="${media.caption}" 
                     onerror="${fallbackImageAction(false)}"
                     class="w-full h-[85%] object-contain rounded-lg shadow-md"
                >
                ${media.caption ? `<p class="text-sm text-gray-600 flex-none">${media.caption}</p>` : ''}
              </div>
            `;

        } else if (data.layout === 'portrait-pair') {
            // Deux images Portrait côte à côte
            contentHTML = `
              <div class="content-page-wrapper flex flex-row justify-around items-center space-x-4 p-2 h-full">
                ${data.media.map((media, i) => `
                  <div class="flex flex-col w-1/2 h-full items-center justify-between p-1">
                      <img src="${media.url}" alt="${media.caption}" 
                           onerror="${fallbackImageAction(false)}"
                           class="w-full h-4/5 object-cover rounded-lg shadow-md"
                      >
                      ${media.caption ? `<p class="text-xs text-gray-600 mt-2 flex-none text-center">${media.caption}</p>` : ''}
                  </div>
                `).join('')}
              </div>
            `;
            
        } else if (data.layout === 'landscape-only') {
            // Une seule image Paysage large
            const media = data.media[0];
            contentHTML = `
              <div class="content-page-wrapper flex-col justify-between items-center space-y-4">
                <img src="${media.url}" alt="${media.caption}" 
                     onerror="${fallbackImageAction(true)}"
                     class="w-full h-[85%] object-contain rounded-lg shadow-md"
                >
                ${media.caption ? `<p class="text-sm text-gray-600 flex-none">${media.caption}</p>` : ''}
              </div>
            `;
            
        } else if (data.layout === 'landscape-pair') {
            // Deux images Paysage empilées verticalement
            
            let imageContainerHTML = `<div class="flex flex-col w-full h-[95%] space-y-4">`; 
            
            data.media.forEach(media => {
                imageContainerHTML += `
                    <div class="flex flex-col w-full h-1/2 items-center p-1">
                        <img src="${media.url}" alt="${media.caption}"
                             onerror="${fallbackImageAction(true)}"
                             class="w-full h-4/5 object-cover rounded-lg shadow-md"
                        >
                        ${media.caption ? `<p class="text-xs text-gray-600 mt-2 flex-none">${media.caption}</p>` : ''}
                    </div>
                `;
            });
            imageContainerHTML += `</div>`;

            contentHTML = `<div class="content-page-wrapper">${imageContainerHTML}</div>`;

        } else if (data.layout === 'video') {
             // Une vidéo intégrée
            const media = data.media[0];
            
            contentHTML = `
              <div class="video-page-content">
                <div class="video-wrapper">
                    <iframe src="${media.url}" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen
                            class="border-none rounded-lg shadow-xl"
                    ></iframe>
                </div>
                ${media.caption ? `<p class="text-base font-semibold text-gray-700 flex-none text-center max-w-sm">${media.caption}</p>` : ''}
              </div>
            `;
        } else if (data.layout === 'text-only') {
             // Texte Centré
            contentHTML = `
                <div class="flex flex-col justify-center items-center h-full p-8 text-center bg-gray-50/70 rounded-lg">
                    <div class="max-w-md mx-auto text-xl md:text-2xl font-serif text-gray-800 leading-relaxed">
                        ${data.text}
                    </div>
                </div>
            `;
        }
      }
      
      const pageElement = $('<div></div>').addClass('page').attr('id', `page-${index + 1}`).html(contentHTML);
      
      if (isCover) {
          pageElement.addClass('cover-page').removeClass('page');
      }

      return pageElement[0].outerHTML;
    }

    // Fonction principale pour gérer le redimensionnement et l'affichage (single/double)
    function resizeAlbum() {
        // Récupérer les dimensions disponibles du conteneur parent
        const container = $('.flip-book-container')[0];
        const maxContainerWidth = container.clientWidth;
        const maxContainerHeight = container.clientHeight;
        
        // Déterminer le mode d'affichage:
        const isSinglePageMode = maxContainerWidth < maxContainerHeight * 1.25; 
        
        let finalWidth, finalHeight;
        
        if (isSinglePageMode) {
            // Mode simple page
            
            finalHeight = Math.min(maxContainerHeight * 0.95, 600); 
            finalWidth = finalHeight / PAGE_ASPECT_RATIO;
            
            if (finalWidth > maxContainerWidth * 0.95) {
                finalWidth = maxContainerWidth * 0.95;
                finalHeight = finalWidth * PAGE_ASPECT_RATIO;
            }
            
            finalWidth = Math.round(finalWidth);
            finalHeight = Math.round(finalHeight);

            // Mise à jour de Turn.js
            if (isTurnInitialized) {
                $album.turn('size', finalWidth, finalHeight);
            }

        } else {
            // Mode double page
            
            finalHeight = Math.min(maxContainerHeight * 0.95, 600); 
            finalWidth = finalHeight * PAGE_ASPECT_RATIO * 2;
            
            if (finalWidth > maxContainerWidth * 0.95) {
                finalWidth = maxContainerWidth * 0.95;
                finalHeight = finalWidth / (PAGE_ASPECT_RATIO * 2);
            }

            finalWidth = Math.round(finalWidth);
            finalHeight = Math.round(finalHeight);

            // Mise à jour de Turn.js
            if (isTurnInitialized) {
                $album.turn('size', finalWidth, finalHeight);
            }
        }

        // Si Turn.js n'est pas initialisé, nous devons le faire maintenant
        if (!isTurnInitialized) {
            
            // 1. Injecter les pages (fait une seule fois)
            albumData.forEach((data, index) => {
                $album.append(createPageElement(data, index));
            });
            
            // 2. Initialisation de Turn.js
            $album.turn({
                width: finalWidth,         
                height: finalHeight,        
                autoCenter: true,   
                display: isSinglePageMode ? 'single' : 'double',  
                elevation: 50,      
                gradients: true,    
                duration: 800       
            });
            
            isTurnInitialized = true;
            $album.css('visibility', 'visible');
            
            // 3. Gestion des événements (attache les écouteurs une seule fois)
            
            $album.on('turning', function(event, page, view) {
                updateNavigation(page);
            });
            
            $prevBtn.on('click', function() {
                $album.turn('previous');
            });

            $nextBtn.on('click', function() {
                $album.turn('next');
            });
            
            updateNavigation($album.turn('page'));

        } else {
            // Si déjà initialisé, juste recentrer
            $album.turn('center');
            updateNavigation($album.turn('page'));
        }
        
    }
    
    // Fonction pour mettre à jour l'état des boutons
    function updateNavigation(page) {
      if ($album.data('__turn_instance')) {
          const totalPages = $album.turn('pages');
          
          $prevBtn.prop('disabled', page <= 1); 
          $nextBtn.prop('disabled', page >= totalPages);
      }
    }
    
    // --- Initialisation de l'application ---
    $(document).ready(function() {
      
      resizeAlbum();
      
      // Adaptation à la taille de l'écran lors du redimensionnement
      let resizeTimeout;
      $(window).resize(function() {
          clearTimeout(resizeTimeout);
          // Délai pour ne pas surcharger le processeur pendant le redimensionnement
          resizeTimeout = setTimeout(resizeAlbum, 100); 
      });
    });
  </script>
</body>
</html>
